$(document).ready((function(){tinymce.init({selector:"textarea.mymce",theme:"modern",height:300,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor paste image"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | image",paste_data_images:!0,paste_preprocess:function(e,t){for(var a,i=t.content,n=/<img[^>]*src="([^"]+)"[^>]*>/g;null!==(a=n.exec(i));){var r=a[1];if(r.startsWith("file:///")){var s=new FileReader;s.onloadend=function(){var e=s.result.split(",")[1];i=i.replace(r,"data:image/jpeg;base64,"+e),t.content=i};var l=new Blob([r],{type:"image/jpeg"});s.readAsDataURL(l)}}}}),tinymce.init({selector:"textarea#mymce3",theme:"modern",height:300,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent"}),tinymce.init({selector:"textarea#mymce5",theme:"modern",height:300,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent"}),tinymce.init({selector:"textarea#mymce6",theme:"modern",height:300,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent"})})),$("#previewSK").on("click",(function(e){var t,a,i=$("#countSigner .row").length,n=$("#SuratKeputusan textarea#txt_perihal, input").map((function(){if(req=$(this).is("[required]"),req)return this.id})).get();for(t=0;t<n.length;++t)if(""==(v=$("#"+n[t]).val())){var r=$("#"+n[t]).attr("data-label");return $("#"+n[t]).removeClass("form-control").addClass("form-control is-invalid"),alert(r+" Tidak Boleh Kosong")}for(a=0;a<i;++a)if("0"==(v=$("select[id=receiver"+a+"]").val()))return alert("Receiver Tidak Boleh Kosong");var s=[];$(".selectdarkReceiver").each((function(){s.push($(this).val())}));var l=[];$(".selectdarkTindasan").each((function(){l.push($(this).val())}));var o=[];$(".selectdarkSigner").each((function(){o.push($(this).val())}));var c=[];$("#tabRefrensi li").each((function(){c.push($(this).data("val")),c.push($(this).data("jenissurat"))}));var u=$("#setKutipan").is(":checked")?1:0,d=[];u&&$(".skKutipan:checked").each((function(){d.push({sign_level:$(this).val()})}));var p=$("input[id=randKEY]").val();let m=$("#tanggalKutipan").val();var h=urlSK,g=idSK,f=data_typeSK,v=$("input[id=jenis_surat]").val(),S=o,k=dariSK,b=$("input[id=lampiran]").val(),w=$("select[id=jenis_prior]").val(),K=$("select[id=kerahasiaan_surat]").val(),T=$("input[id=nokepskot]").val(),y=$("select[id=typeNoSK]").val(),x=$("textarea[id=txt_perihal]").val(),D=tinymce.get("membacaText").getContent(),_=tinymce.get("menimbangText").getContent(),P=tinymce.get("mengingatText").getContent(),C=tinymce.get("mencabutText").getContent(),j=tinymce.get("menetapkanText").getContent(),E=CKEDITOR.instances.editor.getData(),R=$("#brCatatan").is(":checked")?1:0,B=$("#attibuteSKCatatan").is(":checked")?1:0,A=$("#brKutipan").is(":checked")?1:0,O=$("#attibuteSKKutipan").is(":checked")?1:0,F=$("#setPageHeader").is(":checked")?1:0,M=$("#setPageFooter").is(":checked")?1:0,I=urlPDFSK,Y=k+"#"+y;$.ajax({url:h,type:"POST",data:{id:g,data_type:f,jenisSKKutipan:u,kepadaArr:s,melaluiArr:"",refrensiArr:0!=c.length?chunkArrayLoop(c,2):"",tindasanArr:0!=l.length?l:"",jenis_surat:v,random_key:p,detail_signer:S,nokep_sk:"{ GENERATE BY SYSTEM }"==T?"":T,dari:Y,lampiran:b||"",jenis_prior:w,tanggal_surat:"",kerahasiaan_surat:K,txt_perihal:x,kepada:"",tempat:"",bagan1:D,bagan2:_,bagan3:P,bagan5:C,bagan6:j,surat:E,brCatatan:R,setCatatan:B,brKutipan:A,setKutipan:O,tglKutipan:m,signskKutipan:d,setPageHeader:F,setPageFooter:M},success:function(e){$("#previewPDF").html('<iframe width="100%" height="700" src='+I+' title="PDF Result" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'),$("#previewModalPdf").modal("show")}})})),$("#previewSKT").on("click",(function(e){var t=$("#countSigner .row").length,a=$("#SuratKeterangan textarea").map((function(){if(req=$(this).is("[required]"),req)return this.id})).get();for(n=0;n<a.length;++n)if(""==(p=$("#"+a[n]).val())){var i=$("#"+a[n]).attr("data-label");return $("#"+a[n]).removeClass("form-control").addClass("form-control is-invalid"),alert(i+" Tidak Boleh Kosong")}for(s=0;s<t;++s)if("0"==(p=$("select[id=receiver"+s+"]").val()))return alert("Receiver Tidak Boleh Kosong");var n=[];$(".selectdarkSigner").each((function(){n.push($(this).val())}));var r=$("input[id=randKEY]").val(),s=urlSKT,l=(t=idSKT,a=data_typeSKT,i=$("input[id=jenis_surat]").val(),$("textarea[id=txt_perihal]").val()),o=n,c=$("select[id=kerahasiaan_surat]").val(),u=CKEDITOR.instances.editor.getData(),d=$("#setPageHeader").is(":checked")?1:0,m=$("#setPageFooter").is(":checked")?1:0,h=urlPDFSKT;$.ajax({url:s,type:"POST",data:{id:t,data_type:a,jenis_surat:i,random_key:r,detail_signer:o,dari:dariSKT,tanggal_surat:"",kerahasiaan_surat:c,txt_perihal:l,surat:u,setPageHeader:d,setPageFooter:m},success:function(e){$("#previewPDF").html('<iframe width="100%" height="700" src='+h+' title="PDF Result" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'),$("#previewModalPdf").modal("show")}})})),$(".attibuteSK").change((function(){const e=$(this).attr("valuess").substr(2);this.checked?(tinymce.get(e.toLowerCase()+"Text").setContent(""),$("#td"+e).css({display:""})):(tinymce.get(e.toLowerCase()+"Text").setContent(""),$("#td"+e).css({display:"none"}))})),$("#tambahHapusBtnTindasanSK").on("click",(function(e){var t=$("#countTindasan .row").length;console.log(t);var a="";a+='<div class="row">',a+='<div class="col-sm-3">',a+='<div class="form-group">',a+='<select class="form-control selectdarkTindasan" id="tindasan-kategori" name="tindasan[0][]" aria-label="Default select example" data-sub_kategori="0">',a+='<option value="divisi">DIVISI</option>',a+='<option value="cabang">UNIT KERJA</option>',a+='<option value="pekerja">PEKERJA</option>',a+="</select>",a+="</div>",a+="</div>",a+='<div class="col-sm-6">',a+='<div class="form-group">',a+='<select class="select2 selectdarkTindasan" id="tindasan0" name="tindasan[0][]" aria-label="Default select example" style="width: 100%; height: 200px;">',a+='"'+dataDivisionSK+'"',a+="</select>",a+="</div>",a+="</div>",a+='<div class="col-sm-2">',a+='<div class="form-group">',a+='<button class="btn btn-success" type="button" onclick="sub_tindasan();"><i class="fa fa-plus"></i></button>',a+="</div>",a+="</div>",a+="</div>",a+='</div> <div id="subTindasan" class="m-t-20"></div>',$("#countTindasan").append(a),$("#tindasan0").select2(),0!=t?($("#countTindasan").replaceWith('<div class="ml-2 mt-2" id="countTindasan"></div>'),$("#tambahHapusBtnTindasanSK").html("Tambah")):$("#tambahHapusBtnTindasanSK").html("Hapus")})),$("#submitSaveSK").click((function(e){"complete"==document.readyState&&Swal.fire({title:"Apakah Yakin",text:"Telah Membuat Surat ini Dengan Benar!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Kirim"}).then((e=>{e.value&&(Swal.fire({title:"MEMPROSES",html:"Mengirim Notifikasi..!",allowOutsideClick:!1,showConfirmButton:!1}).then((e=>{e.dismiss,Swal.DismissReason.timer})),$("#SuratKeputusan").submit())}))})),$("#submitSaveSKT").on("click",(function(e){"complete"==document.readyState&&Swal.fire({title:"Apakah Yakin",text:"Telah Membuat Surat ini Dengan Benar!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Kirim"}).then((e=>{e.value&&(Swal.fire({title:"MEMPROSES",html:"Mengirim Notifikasi..!",allowOutsideClick:!1,showConfirmButton:!1}).then((e=>{e.dismiss,Swal.DismissReason.timer})),$("#SuratKeterangan").submit())}))})),$("#saveDraftSuratSK").on("click",(function(e){$.ajax({type:"POST",url:urlsaveDraftSuratSK,data:{jnsSurat:"SK"},success:function(e){Swal.fire({title:"Auto close alert!",html:"I will close in <strong></strong> draft seconds.",timer:1e3}).then((e=>{e.dismiss===Swal.DismissReason.timer&&(window.location.href=urlupdateDraftSuratSK2)}))}}),e.preventDefault()})),$("#saveDraftSuratSKT").on("click",(function(e){$.ajax({type:"POST",url:urlsaveDraftSuratSKT,data:{jnsSurat:"SKT"},success:function(e){Swal.fire({title:"Auto close alert!",html:"I will close in <strong></strong> draft seconds.",timer:1e3}).then((e=>{e.dismiss===Swal.DismissReason.timer&&(window.location.href=urlupdateDraftSuratSKT2)}))}}),e.preventDefault()})),$("#updateDraftSuratSK").on("click",(function(e){var t=idSK;$.ajax({type:"POST",url:urlupdateDraftSuratSK1,data:{ids:t,jnsSurat:"SK"},success:function(e){Swal.fire({title:"Auto close alert!",html:"I will close in <strong></strong> draft seconds.",timer:1e3}).then((e=>{e.dismiss===Swal.DismissReason.timer&&(window.location.href=urlupdateDraftSuratSK2)}))}})})),$("#updateDraftSuratSKT").on("click",(function(e){var t=idSKT;$.ajax({type:"POST",url:urlupdateDraftSuratSKT1,data:{ids:t,jnsSurat:"SKT"},success:function(e){Swal.fire({title:"Auto close alert!",html:"I will close in <strong></strong> draft seconds.",timer:1e3}).then((e=>{e.dismiss===Swal.DismissReason.timer&&(window.location.href=urlupdateDraftSuratSKT2)}))}})})),$("#updateDraftSuratEditSK").on("click",(function(e){var t=idEdit;$.ajax({type:"POST",url:urlupdateDraftSuratEdit1,data:{ids:t},success:function(e){Swal.fire({title:"Auto close alert!",html:"I will close in <strong></strong> draft seconds.",timer:1e3}).then((e=>{e.dismiss===Swal.DismissReason.timer&&(window.location.href=urlupdateDraftSuratEdit2)}))}})})),$("#updateDraftSuratEditSKT").on("click",(function(e){var t=idEdit;$.ajax({type:"POST",url:urlupdateDraftSuratEdit1,data:{ids:t},success:function(e){Swal.fire({title:"Auto close alert!",html:"I will close in <strong></strong> draft seconds.",timer:1e3}).then((e=>{e.dismiss===Swal.DismissReason.timer&&(window.location.href=urlupdateDraftSuratEdit2)}))}})})),$("#btnBtnCloseModalSK").on("click",(function(e){$.ajax({type:"POST",url:"showPreview/closed",success:function(e){console.log(e)}}),e.preventDefault()})),$("#previewAdditionEdit"+jenis_surat).on("click",(function(e){$("#loader, #loader2, #loader3").css("display","block");var t,a,i=$("#countSigner .row").length,n=$("#data_bagian").length,r=$("select[id=data_bagian]").val(),s=$("#SuratKeterangan textarea, #SuratKeterangan input, #SuratKeputusan textarea").map((function(){if(req=$(this).is("[required]"),req)return this.id})).get();for(t=0;t<s.length;++t)if(""==(w=$("#"+s[t]).val())){var l=$("#"+s[t]).attr("data-label");return $("#"+s[t]).removeClass("form-control").addClass("form-control is-invalid"),alert(l+" Tidak Boleh Kosong"),setTimeout(showPage,200)}for(a=0;a<i;++a)if("0"==(w=$("#SuratKeputusan select[id=receiver"+a+"]").val()))return alert("Penerima Tidak Boleh Kosong"),setTimeout(showPage,200);var o=[];$(".selectdarkReceiver").each((function(){o.push($(this).val())}));var c=o[1],u=[];$(".selectdarkTindasan").each((function(){u.push($(this).val())}));var d=[];$(".selectdarkMelalui").each((function(){d.push($(this).val())}));var p=[];$(".selectdarkSigner").each((function(){p.push($(this).val())}));var m=[];if($("#tabRefrensi li").each((function(){m.push($(this).data("val")),m.push($(this).data("jenissurat"))})),"All"==c&&o.length>2)return alert("Penerima --Semua-- Tidak Bisa Digabung Dengan Penerima Lain"),setTimeout(showPage,200);var h=$("#setKutipan").is(":checked")?1:0,g=[];h&&$(".skKutipan:checked").each((function(){g.push({sign_level:$(this).val()})}));let f=$("#tanggalKutipan").val();var v=$("input[id=randKEY]").val(),S=urlEdit,k=idEdit,b=data_typeEdit,w=$("input[id=jenis_surat]").val(),K=p,T=0!=n?r:dariEdit,y=$("select[id=kerahasiaan_surat]").val(),x=CKEDITOR.instances.editor.getData(),D=$("#setPageHeader").is(":checked")?1:0,_=$("#setPageFooter").is(":checked")?1:0,P=$("textarea[id=txt_perihal]").val(),C=urlPDFEdit;if("SK"==w)var j=$("input[id=lampiran]").val(),E=$("select[id=jenis_prior]").val(),R=$("input[id=nokepskot]").val(),B=tinymce.get("membacaText").getContent(),A=tinymce.get("menimbangText").getContent(),O=tinymce.get("mengingatText").getContent(),F=tinymce.get("mencabutText").getContent(),M=tinymce.get("menetapkanText").getContent(),I=$("#brCatatan").is(":checked")?1:0,Y=$("#attibuteSKCatatan").is(":checked")?1:0,H=$("#brKutipan").is(":checked")?1:0,q=$("#attibuteSKKutipan").is(":checked")?1:0;$.ajax({url:S,type:"POST",data:{id:k,data_type:b,jenisSKKutipan:h,jenis_surat:w,random_key:v,detail_signer:K,dari:T,kerahasiaan_surat:y,surat:x,setPageHeader:D,setPageFooter:_,kepadaArr:o,melaluiArr:0!=d.length?d:"",refrensiArr:0!=m.length?chunkArrayLoop(m,2):"",tindasanArr:0!=u.length?u:"",nokep_sk:"{ GENERATE BY SYSTEM }"==R?"":R,lampiran:j||"",jenis_prior:E,tanggal_surat:"",txt_perihal:P,bagan1:B,bagan2:A,bagan3:O,bagan5:F,bagan6:M,brCatatan:I,setCatatan:Y,brKutipan:H,setKutipan:q,tglKutipan:f,signskKutipan:g},success:function(e){return $("#previewPDF").html('<iframe width="100%" height="700" src='+C+' title="PDF Result" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'),$("#previewModalPdf").modal("show"),setTimeout(showPage,100)}})}));
